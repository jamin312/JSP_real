<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<script src='./dist/index.global.js'></script>
<script>

  document.addEventListener('DOMContentLoaded', async function() {
	  
	  // 값을 담을 변수 선언
	  let eventList = [
	  ];
	  
	  // ajax 실행 async await
	  let result = await fetch('eventList.do');
	  let data = await result.json();
	  eventList = data;
	  
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      initialDate: new Date(), //'오늘',
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectMirror: true,
      select: async function(arg) {
    	  console.log(arg); // title, startStr, endStr
        var title = prompt('일정을 등록하세요!');
        if (title) {
        	let resolve = await fetch('addEvent.do?title=' + title + '&start=' + arg.startStr + '&end=' + arg.endStr)
        	let result = await resolve.json()
        	if(result.retCode == 'OK'){
        		// 캘린더에 일정을 추가
  	          calendar.addEvent({
  	            title: title,
  	            start: arg.start,
  	            end: arg.end,
  	            allDay: arg.allDay
  	          }); // end 일정 추가
        	} else if (result.retCode == 'NG') {
        		alert('실패');
        	} else {
        		alert('알 수 없는 에러 코드');
        	}
        } // end if
        calendar.unselect()
      },
      eventClick: async function(arg) {
    	 // console.log(arg); title=> arg.event.title
        if (confirm('Are you sure you want to delete this event?')) {
    	  let resolve = await fetch('removeEvent.do?title=' + arg.event.title)
    	  let result = await resolve.json()
    		 if (result.retCode == 'OK') {
    			 arg.event.remove()
     	          }	else if (result.retCod == 'NG') {
 				alert('처리 중 예외 발생');
 			} else {
 				alert('알 수 없는 예외');
 			}
    	 }
      },
      editable: true,
      dayMaxEvents: true, // allow "more" link when too many events
      events: eventList
     });

    calendar.render();
	 
  }) // end DOMContentLoaded
</script>
<style>
body {
	margin: 40px 10px;
	padding: 0;
	font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
	font-size: 14px;
}

#calendar {
	max-width: 1100px;
	margin: 0 auto;
}
</style>
</head>
<body>

	<div id='calendar'></div>

</body>
</html>
